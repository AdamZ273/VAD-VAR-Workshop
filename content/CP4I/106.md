

# Provisioning an OpenShift Cluster
- This tutorial uses a TechZone environment
- Reserve the following environment (search for the following): OpenShift Cluster (VMware on IBM Cloud) - IPI - Public
- Ensure the following settings are selected (everything else can be default):

	- Storage: ODF - 2TB
	- Worker node count: 5
	- Worker node flavor: 16 vCPU x 64 GB - 300 GB ephemeral storage

## Minimum cluster requirements by Model[​](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/provision-an-openshift-cluster#minimum-cluster-requirements-by-model "Direct link to Minimum cluster requirements by Model")
![](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/assets/images/min_requirements-5866586d01c150a77975a3d2ef9e2acd.png "")




# Installing the CPD CLI
- Reference doc: <https://www.ibm.com/docs/en/cloud-paks/cp-data/4.5.x?topic=workstation-installing-cloud-pak-data-cli>

- **Note:**  All your cluster information is available on the TechZone reservation page(cluster admin user/pass, bastion admin user/pass, web console, bastion ssh connection, api url)
- Open a terminal window and SSH into your bastion:

	- TechZone provides a "bastion SSH connection" command that you can copy and paste into your terminal
	- Use your bastion password to login
	- Once logged in make a directory name "cpd" to put our cpd cli into	

		- `mkdir cpd`

## Download the CPD CLI[​](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/install-the-cpd-cli#download-the-cpd-cli "Direct link to Download the CPD CLI")
- Use **one**  of the two following methods to download and extract your cpd-cli contents

	### Method 1: Run the following commands in your "cpd" directory within your bastion[​](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/install-the-cpd-cli#method-1-run-the-following-commands-in-your-cpd-directory-within-your-bastion "Direct link to Method 1: Run the following commands in your "cpd" directory within your bastion")
	``` codeBlockLines_e6Vv
	curl -LSo cpd-cli-linux-EE-13.tgz https://github.com/IBM/cpd-cli/releases/download/v13.0.4/cpd-cli-linux-EE-13.0.4.tgz

	  tar -xf cpd-cli-linux-EE-13.tgz
	```

	### Method 2: Move CPD CLI download to bastion[​](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/install-the-cpd-cli#method-2-move-cpd-cli-download-to-bastion "Direct link to Method 2: Move CPD CLI download to bastion")
	- On your local machine:	

		- Download Linux EE version of CPD (must be 13.0.1+): <https://github.com/IBM/cpd-cli/releases>
	- In this tutorial, we will use FileZilla which you can download on your local machine:	

		- Start FileZilla and open the site manager (first icon on top toolbar)	
		- Choose new site and the following settings:			

			- Protocol: SFTP			
			- Host: your bastion host can be found under your bastion SSH connection command(everything after @, before -p)			
			- Port: your port(number after -p)			
			- User: bastion user			
			- Password: bastion password	
		- Click ok on any popups	
		- Locate your CPD CLI download from your local files and move them to your newly created cpd directory within bastion (drag and drop in FileZilla)
	- Extract the contents and make cpd-cli executable	

		- Navigate to your terminal (where you are logged in to the bastion) and extract the contents of our download			

			``` codeBlockLines_e6Vv			
			cd cpd			

			tar -xvf cpd-cli-linux-EE-13.0.3.tgz			

			cd cpd-cli-linux-EE-13.0.3-40			
			```

## CPD CLI Note[​](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/install-the-cpd-cli#cpd-cli-note "Direct link to CPD CLI Note")
- For the sake of the tutorial, the cli is executable from this directory only, using `./cpd-cli` 
	- Therefore, any future commands in this tutorial that include `./cpd-cli`  must be run from this directory


# Installing CPD and CPD Platform
- Run the following commands to install CPD and CPD Platform:

``` codeBlockLines_e6Vv
./cpd-cli manage apply-cluster-components --release=4.8.0 --license_acceptance=true

./cpd-cli manage authorize-instance-topology --cpd_operator_ns=cpd-operator --cpd_instance_ns=cpd-instance

./cpd-cli manage setup-instance-topology --release=4.8.0 --cpd_operator_ns=cpd-operator --cpd_instance_ns=cpd-instance --license_acceptance=true

# cpd platform install
./cpd-cli manage apply-olm --components=cpd_platform  --release=4.8.0 --cpd_operator_ns=cpd-operator --license_acceptance=true

./cpd-cli manage apply-cr --components=cpd_platform --release=4.8.0 --license_acceptance=true --cpd_operator_ns=cpd-operator --cpd_instance_ns=cpd-instance --block_storage_class=ocs-storagecluster-ceph-rbd --file_storage_class=ocs-storagecluster-cephfs --license_acceptance=true
```





# Installing watsonx.ai
- Run the following to install watsonx.ai:

	``` codeBlockLines_e6Vv
	./cpd-cli manage apply-olm --components=watsonx_ai  --release=4.8.0 --cpd_operator_ns=cpd-operator --license_acceptance=true

	./cpd-cli manage apply-cr --components=watsonx_ai --release=4.8.0 --license_acceptance=true --cpd_operator_ns=cpd-operator --cpd_instance_ns=cpd-instance --block_storage_class=ocs-storagecluster-ceph-rbd --file_storage_class=ocs-storagecluster-cephfs --license_acceptance=true
	```

1. use the following command to get the cpadmin password:

	``` codeBlockLines_e6Vv
	oc project cpd-instance 

	oc get secret ibm-iam-bindinfo-platform-auth-idp-credentials -o 'jsonpath={.data.admin_password}' | base64 --decode
	```
2. Login to Cloud pak for Data and create a the watsonx.ai project

	Select All Projects

	![](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/assets/images/allprojects-2761ef6d0296a8c68ba212e418af595d.png "")
3. Create a new Project

	![](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/assets/images/new_project-22948832201388c7c0f88490e70aad17.png "")
4. Select the Assets tab and create a new Asset

	![](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/assets/images/new_asset-e5c82ca03faccb414c6e036b25401eda.png "")
5. Select Prompt Lab

	![](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/assets/images/prompt_lab-3123b0521ab2acaaf17b6252004b13c7.png "")
6. Use the Prompt Lab page to select and create Prompts for Models

	![](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/assets/images/prompts-b955463abdb3fc8158d80b9c82e6cd14.png "")

## Add a Model[​](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/watsonx-ai-install#add-a-model "Direct link to Add a Model")
- The following Models are in the GA build.

	``` codeBlockLines_e6Vv
	install_model_list:
	  - meta-llama-llama-2-70b-chat
	  - bigcode-starcoder
	  - ibm-granite-13b-instruct-v1
	  - ibm-granite-13b-chat-v1
	  - ibm-mpt-7b-instruct2
	  - google-flan-ul2
	  - google-flan-t5-xxl
	  - eleutherai-gpt-neox-20b
	  - bigscience-mt0-xxl
	```
- Edit the watsonxaifm custom resource `oc edit watsonxaiifm`
- In the Spec section add `install_model_list`  and the model you need to fetch and save

	![](https://pages.github.ibm.com/Anand-Das5/cpd-watsonx-install/assets/images/model_fetch-936f1177d99293599f1b1123c42e0ffd.png "")
- Verify the Container by running the following command

	``` codeBlockLines_e6Vv
	oc get pods -o wide | egrep "check-job|install-job" | egrep -v "ccs|dsx|conn"
	```